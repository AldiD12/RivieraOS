<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Business API Endpoints</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .pending { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 300px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Business API Endpoints Test</h1>
        <p>This tool tests the business-level API endpoints that are currently causing CORS errors.</p>
        
        <!-- Token Input -->
        <div class="test-section">
            <h3>Authentication</h3>
            <input type="text" id="tokenInput" placeholder="Enter JWT token here" />
            <button onclick="saveToken()">Save Token</button>
            <p id="tokenStatus">No token set</p>
        </div>

        <!-- Test Business Profile -->
        <div class="test-section pending" id="profileTest">
            <h3>1. Business Profile</h3>
            <button onclick="testBusinessProfile()">Test GET /api/business/Profile</button>
            <div id="profileResult"></div>
        </div>

        <!-- Test Business Dashboard -->
        <div class="test-section pending" id="dashboardTest">
            <h3>2. Business Dashboard</h3>
            <button onclick="testBusinessDashboard()">Test GET /api/business/Dashboard</button>
            <div id="dashboardResult"></div>
        </div>

        <!-- Test Business Staff -->
        <div class="test-section pending" id="staffTest">
            <h3>3. Business Staff</h3>
            <button onclick="testBusinessStaff()">Test GET /api/business/Staff</button>
            <div id="staffResult"></div>
        </div>

        <!-- Test Business Categories -->
        <div class="test-section pending" id="categoriesTest">
            <h3>4. Business Categories</h3>
            <button onclick="testBusinessCategories()">Test GET /api/business/Categories</button>
            <div id="categoriesResult"></div>
        </div>

        <!-- Test Business Venues -->
        <div class="test-section pending" id="venuesTest">
            <h3>5. Business Venues</h3>
            <button onclick="testBusinessVenues()">Test GET /api/business/Venues</button>
            <div id="venuesResult"></div>
        </div>

        <!-- Test All -->
        <div class="test-section">
            <h3>Run All Tests</h3>
            <button onclick="runAllTests()">Test All Endpoints</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://blackbear-api.kindhill-9a9eea44.italynorth.azurecontainerapps.io/api';
        let authToken = '';

        function saveToken() {
            authToken = document.getElementById('tokenInput').value.trim();
            if (authToken) {
                document.getElementById('tokenStatus').textContent = `Token saved: ${authToken.substring(0, 20)}...`;
                document.getElementById('tokenStatus').style.color = 'green';
            } else {
                document.getElementById('tokenStatus').textContent = 'No token set';
                document.getElementById('tokenStatus').style.color = 'red';
            }
        }

        async function makeRequest(endpoint, method = 'GET') {
            if (!authToken) {
                return { error: 'No authentication token set' };
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                };

                if (response.ok) {
                    try {
                        result.data = await response.json();
                    } catch (e) {
                        result.data = await response.text();
                    }
                } else {
                    try {
                        result.error = await response.text();
                    } catch (e) {
                        result.error = 'Failed to read error response';
                    }
                }

                return result;
            } catch (error) {
                return {
                    error: error.message,
                    type: 'Network/CORS Error'
                };
            }
        }

        function updateTestResult(testId, result) {
            const testElement = document.getElementById(testId);
            const resultElement = document.getElementById(testId.replace('Test', 'Result'));
            
            if (result.ok) {
                testElement.className = 'test-section success';
                resultElement.innerHTML = `
                    <p><strong>✅ SUCCESS</strong></p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `;
            } else if (result.type === 'Network/CORS Error') {
                testElement.className = 'test-section error';
                resultElement.innerHTML = `
                    <p><strong>❌ CORS/Network Error</strong></p>
                    <p>This endpoint is not implemented or CORS is not configured.</p>
                    <pre>Error: ${result.error}</pre>
                `;
            } else {
                testElement.className = 'test-section error';
                resultElement.innerHTML = `
                    <p><strong>❌ HTTP Error ${result.status}</strong></p>
                    <pre>${result.error || result.statusText}</pre>
                `;
            }
        }

        async function testBusinessProfile() {
            console.log('Testing business profile...');
            const result = await makeRequest('/business/Profile');
            updateTestResult('profileTest', result);
        }

        async function testBusinessDashboard() {
            console.log('Testing business dashboard...');
            const result = await makeRequest('/business/Dashboard');
            updateTestResult('dashboardTest', result);
        }

        async function testBusinessStaff() {
            console.log('Testing business staff...');
            const result = await makeRequest('/business/Staff');
            updateTestResult('staffTest', result);
        }

        async function testBusinessCategories() {
            console.log('Testing business categories...');
            const result = await makeRequest('/business/Categories');
            updateTestResult('categoriesTest', result);
        }

        async function testBusinessVenues() {
            console.log('Testing business venues...');
            const result = await makeRequest('/business/Venues');
            updateTestResult('venuesTest', result);
        }

        async function runAllTests() {
            if (!authToken) {
                alert('Please set an authentication token first');
                return;
            }

            console.log('Running all business API tests...');
            await testBusinessProfile();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testBusinessDashboard();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testBusinessStaff();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testBusinessCategories();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testBusinessVenues();
        }

        function clearResults() {
            const testSections = ['profileTest', 'dashboardTest', 'staffTest', 'categoriesTest', 'venuesTest'];
            testSections.forEach(testId => {
                document.getElementById(testId).className = 'test-section pending';
                document.getElementById(testId.replace('Test', 'Result')).innerHTML = '';
            });
        }

        // Auto-load token from localStorage if available
        window.onload = function() {
            const savedToken = localStorage.getItem('token') || localStorage.getItem('azure_jwt_token');
            if (savedToken) {
                document.getElementById('tokenInput').value = savedToken;
                saveToken();
            }
        };
    </script>
</body>
</html>